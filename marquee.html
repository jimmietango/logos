<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Logos Marquee</title>
<style>
  :root{
    --strip-height: 100px;  /* pairs with 100px iframe */
    --logo-gap: 48px;
    --speed-seconds: 60;    /* larger = slower auto-scroll */
  }

  html,body{ margin:0; padding:0; background:transparent; height:100% }
  body{ display:flex; align-items:center; justify-content:center; min-height:var(--strip-height) }

  .trusted-logos{ width:100vw; overflow:hidden; padding:0; -webkit-user-select:none; user-select:none }
  .viewport{ position:relative; overflow:hidden; width:100%; height:var(--strip-height); display:flex; align-items:center; cursor:default }

  .track{
    display:flex; align-items:center; gap:var(--logo-gap);
    padding:0 24px; width:max-content; will-change:transform;
    transform:translate3d(0,0,0);
  }
  .track li{ list-style:none; flex:0 0 auto }
  .track img{ display:block; height:calc(var(--strip-height)*0.36); width:auto; filter:grayscale(1); opacity:.95 }

  @media (prefers-reduced-motion: reduce){
    :root{ --speed-seconds: 0; }
  }

  @media (max-width: 768px){
    :root{ --strip-height: 90px; --logo-gap: 32px }
  }
  @media (max-width: 480px){
    :root{ --strip-height: 86px; --logo-gap: 24px }
  }
</style>

<body>
  <section class="trusted-logos" aria-label="Trusted by top companies">
    <div class="viewport" id="viewport">
      <ul class="track" id="track" aria-label="Client logos">
        <!-- Set A -->
        <li><img src="https://jimmietango.github.io/logos/aaadobe.svg" alt="Adobe"></li>
        <li><img src="https://jimmietango.github.io/logos/aaaepam.svg" alt="EPAM"></li>
        <li><img src="https://jimmietango.github.io/logos/aaagoogle.svg" alt="Google"></li>
        <li><img src="https://jimmietango.github.io/logos/aaahappinessindex.svg" alt="The Happiness Index"></li>
        <li><img src="https://jimmietango.github.io/logos/aaaibm.svg" alt="IBM"></li>
        <li><img src="https://jimmietango.github.io/logos/aaamarigold.svg" alt="Marigold"></li>
        <li><img src="https://jimmietango.github.io/logos/aaamicrosoft.svg" alt="Microsoft"></li>
        <li><img src="https://jimmietango.github.io/logos/aaaoracle.svg" alt="Oracle"></li>
        <li><img src="https://jimmietango.github.io/logos/aaasalesforce.svg" alt="Salesforce"></li>
        <li><img src="https://jimmietango.github.io/logos/aaasitecore.svg" alt="Sitecore"></li>
        <li><img src="https://jimmietango.github.io/logos/aacoveo.svg" alt="Coveo"></li>
        <li><img src="https://jimmietango.github.io/logos/aaepsilon.svg" alt="Epsilon"></li>
        <li><img src="https://jimmietango.github.io/logos/aatealium.svg" alt="Tealium"></li>
        <li><img src="https://jimmietango.github.io/logos/aibl.svg" alt="AiBL"></li>
        <li><img src="https://jimmietango.github.io/logos/alokai.svg" alt="Alokai"></li>
        <li><img src="https://jimmietango.github.io/logos/aquent.svg" alt="Aquent"></li>
        <li><img src="https://jimmietango.github.io/logos/bazaarvoice.svg" alt="Bazaarvoice"></li>
        <li><img src="https://jimmietango.github.io/logos/bynder.svg" alt="Bynder"></li>
        <li><img src="https://jimmietango.github.io/logos/channeladvisor.svg" alt="ChannelAdvisor"></li>
        <li><img src="https://jimmietango.github.io/logos/equifax.svg" alt="Equifax"></li>
        <li><img src="https://jimmietango.github.io/logos/lionbridge.svg" alt="Lionbridge"></li>
        <li><img src="https://jimmietango.github.io/logos/meta.svg" alt="Meta"></li>
        <li><img src="https://jimmietango.github.io/logos/northhighland.svg" alt="North Highland"></li>
        <li><img src="https://jimmietango.github.io/logos/omnicomhealthgroup.svg" alt="Omnicom Health Group"></li>
        <li><img src="https://jimmietango.github.io/logos/zone.svg" alt="Zone"></li>

        <!-- Set B (duplicate for seamless loop) -->
        <li><img src="https://jimmietango.github.io/logos/aaadobe.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/aaaepam.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/aaagoogle.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/aaahappinessindex.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/aaaibm.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/aaamarigold.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/aaamicrosoft.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/aaaoracle.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/aaasalesforce.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/aaasitecore.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/aacoveo.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/aaepsilon.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/aatealium.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/aibl.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/alokai.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/aquent.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/bazaarvoice.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/bynder.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/channeladvisor.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/equifax.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/lionbridge.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/meta.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/northhighland.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/omnicomhealthgroup.svg" alt="" aria-hidden="true"></li>
        <li><img src="https://jimmietango.github.io/logos/zone.svg" alt="" aria-hidden="true"></li>
      </ul>
    </div>
  </section>

<script>
  // --- Optional: override speed/height/gap via URL query params ---
  (function tuneFromQuery(){
    const p = new URLSearchParams(location.search);
    const s = p.get('speed') || p.get('s');
    const h = p.get('height') || p.get('h');
    const g = p.get('gap') || p.get('g');
    const root = document.documentElement.style;
    if (s) root.setProperty('--speed-seconds', String(+s));
    if (h) root.setProperty('--strip-height', String(+h) + 'px');
    if (g) root.setProperty('--logo-gap', String(+g) + 'px');
  })();

  // --- Cache-bust only when parent passes ?v=... ---
  (function cacheBustOnce(){
    const V = new URLSearchParams(location.search).get('v');
    if (!V) return;
    document.querySelectorAll('.track img').forEach(img => {
      try{
        const u = new URL(img.src);
        u.searchParams.set('v', V);
        img.src = u.toString();
      }catch(e){
        img.src = img.src + (img.src.includes('?') ? '&' : '?') + 'v=' + encodeURIComponent(V);
      }
    });
  })();

  // --- Helper: wait until all marquee images are loaded & decoded ---
  function whenLogosReady() {
    const imgs = Array.from(document.querySelectorAll('.track img'));
    return Promise.all(imgs.map(img => {
      if (img.complete) {
        // If already complete, try to wait for decode (no-op for SVG in some browsers)
        return (img.decode ? img.decode().catch(()=>{}) : Promise.resolve());
      }
      return new Promise(res => {
        const done = () => res();
        img.addEventListener('load', done, { once: true });
        img.addEventListener('error', done, { once: true });
      });
    }));
  }

  // --- Auto-scroll loop (stable regardless of cache) ---
  (function marquee(){
    const track = document.getElementById('track');
    let x = 0, half = 0, pxPerSec = 0, rafId = 0;

    function computeSpeed() {
      const seconds = parseFloat(getComputedStyle(document.documentElement)
        .getPropertyValue('--speed-seconds')) || 0;
      pxPerSec = seconds > 0 ? (half / seconds) : 0;
    }

    function wrap(){ if (x <= -half) x += half; if (x >= 0) x -= half; }

    let lastT = 0;
    function tick(t){
      if (!lastT) lastT = t;
      const dt = (t - lastT) / 1000;
      lastT = t;
      if (pxPerSec > 0) { x -= pxPerSec * dt; wrap(); }
      track.style.transform = `translate3d(${x}px,0,0)`;
      rafId = requestAnimationFrame(tick);
    }

    async function measureAndStart() {
      // Cancel any existing loop before re-measuring
      if (rafId) cancelAnimationFrame(rafId);

      // Ensure images have sizes (works the same with cached or fresh loads)
      await whenLogosReady();

      // Force a layout read after images are ready
      // Since you duplicatâ€‹ed A+B for seamless loop, half is exactly half the scrollWidth
      half = track.scrollWidth / 2;

      computeSpeed();

      // Preserve current offset on re-measure (prevents jumps on resize/pageshow)
      const currentLeft = track.getBoundingClientRect().left;
      x = currentLeft;
      wrap();

      lastT = 0;
      rafId = requestAnimationFrame(tick);
    }

    // Initial start
    measureAndStart();

    // Re-measure when:
    // - The page returns from bfcache (opening in new tab/back/forward)
    // - Window resizes
    // - Any logo finishes loading later (edge case)
    window.addEventListener('pageshow', () => measureAndStart());
    window.addEventListener('resize', () => measureAndStart());
    document.addEventListener('load', e => {
      if (e.target && e.target.tagName === 'IMG') measureAndStart();
    }, true);
  })();
</script>
</body>
</html>
